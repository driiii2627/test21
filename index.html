<!DOCTYPE html>
<html lang="pt-BR" data-theme="gamer-dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameShare - Descubra e Compartilhe Jogos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* ============================================= */
        /* --- Variáveis de Tema (Raiz) --- */
        /* ============================================= */
        /* Define as variáveis para qualquer elemento que tenha o atributo data-theme.
           Isso é a chave para as pré-visualizações funcionarem. */
        :root,
        [data-theme='gamer-dark'] {
            --background-color: #0D1117;
            --card-background: rgba(15, 23, 42, 0.6);
            --card-content-bg: rgba(15, 23, 42, 0.8);
            --glass-background: rgba(30, 41, 59, 0.5);
            --text-primary: #E2E8F0;
            --text-muted: #94A3B8;
            --border-color: rgba(255, 255, 255, 0.1);
            --accent-violet: #8b5cf6;
            --accent-blue: #3b82f6;
            --button-hover-bg: rgba(51, 65, 85, 0.8);
            --button-bg: rgba(51, 65, 85, 0.6);
            --category-tag-bg: rgba(139, 92, 246, 0.2);
            --category-tag-text: #c4b5fd;
            --header-hover-bg: #1e293b;
        }

        [data-theme='gamer-light'] {
            --background-color: #e2e8f0;
            --card-background: rgba(203, 213, 225, 0.6);
            --card-content-bg: rgba(255, 255, 255, 0.8);
            --glass-background: rgba(226, 232, 240, 0.7);
            --text-primary: #1e293b;
            --text-muted: #475569;
            --border-color: rgba(148, 163, 184, 0.4);
            --accent-violet: #8b5cf6;
            --accent-blue: #3b82f6;
            --button-hover-bg: #cbd5e1;
            --button-bg: #e2e8f0;
            --category-tag-bg: #ede9fe;
            --category-tag-text: #6d28d9;
            --header-hover-bg: #cbd5e1;
        }
        
        [data-theme='matrix-dark'] {
            --background-color: #01100a;
            --card-background: rgba(4, 29, 19, 0.7);
            --card-content-bg: rgba(4, 29, 19, 0.9);
            --glass-background: rgba(7, 46, 31, 0.5);
            --text-primary: #39ff14;
            --text-muted: #008f11;
            --border-color: rgba(57, 255, 20, 0.2);
            --accent-violet: #39ff14;
            --accent-blue: #008f11;
            --button-hover-bg: rgba(13, 71, 46, 0.8);
            --button-bg: rgba(13, 71, 46, 0.6);
            --category-tag-bg: rgba(57, 255, 20, 0.15);
            --category-tag-text: #39ff14;
            --header-hover-bg: #072e1f;
        }

        [data-theme='minty-light'] {
            --background-color: #f0fdfa;
            --card-background: rgba(204, 251, 241, 0.7);
            --card-content-bg: rgba(240, 253, 250, 0.9);
            --glass-background: rgba(204, 251, 241, 0.5);
            --text-primary: #115e59;
            --text-muted: #14b8a6;
            --border-color: rgba(20, 184, 166, 0.3);
            --accent-violet: #2dd4bf;
            --accent-blue: #0d9488;
            --button-hover-bg: #ccfbf1;
            --button-bg: #f0fdfa;
            --category-tag-bg: #ccfbf1;
            --category-tag-text: #115e59;
            --header-hover-bg: #ccfbf1;
        }

        /* ============================================= */
        /* --- Estilos Base --- */
        /* ============================================= */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 20px 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        html[data-theme='gamer-light'] body, html[data-theme='minty-light'] body {
             background-image: radial-gradient(circle at 1px 1px, rgba(0,0,0,0.05) 1px, transparent 0);
        }
        html[data-theme='matrix-dark'] body {
            background-image: radial-gradient(circle at 1px 1px, rgba(57, 255, 20, 0.08) 1px, transparent 0);
        }

        .glass-effect {
            background: var(--glass-background);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
        }

        /* ============================================= */
        /* --- Componentes Reutilizáveis --- */
        /* ============================================= */
        .header-button { background-color: transparent; transition: background-color 0.2s; }
        .header-button:hover { background-color: var(--header-hover-bg); }
        .lang-option:hover { background-color: var(--header-hover-bg); }

        .glass-card {
            background: var(--card-background);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            transition: background 0.4s, transform 0.4s, box-shadow 0.4s;
        }
        .glass-card img { transition: transform 0.4s ease; }
        .glass-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2), 0 0 15px var(--accent-violet);
        }
        .glass-card:hover img { transform: scale(1.05); }
        .card-content { background-color: var(--card-content-bg); }
        .card-button { background-color: var(--button-bg); color: var(--text-primary); transition: background-color 0.2s; }
        .card-button:hover { background-color: var(--button-hover-bg); }
        .category-tag { background-color: var(--category-tag-bg); color: var(--category-tag-text); }

        .category-filter { background-color: var(--button-bg); color: var(--text-muted); transition: background-color 0.2s, color 0.2s; }
        .category-filter:hover { background-color: var(--button-hover-bg); }
        .category-filter.active { background-color: var(--accent-violet); color: white !important; }

        .btn-gradient { background-image: linear-gradient(to right, var(--accent-blue), var(--accent-violet)); transition: all 0.3s ease; }
        .btn-gradient:hover { box-shadow: 0 0 20px var(--accent-violet); }
        
        /* ============================================= */
        /* --- Modais --- */
        /* ============================================= */
        .modal-backdrop { background-color: rgba(0,0,0,0.5); backdrop-filter: blur(4px); transition: background-color 0.3s; }
        html[data-theme='gamer-light'] .modal-backdrop, html[data-theme='minty-light'] .modal-backdrop { background-color: rgba(30, 41, 59, 0.3); }
        
        .addon-item { background-color: var(--glass-background); border: 1px solid var(--border-color); color: var(--text-primary); }
        .addon-download-btn { background-color: var(--button-bg); transition: background-color 0.2s; }
        .addon-download-btn:hover { background-color: var(--button-hover-bg); }
        
        .theme-preview { border: 2px solid var(--border-color); cursor: pointer; transition: transform 0.2s, border-color 0.2s; }
        .theme-preview:hover { transform: scale(1.05); border-color: var(--accent-violet); }
        .theme-preview.active { border-color: var(--accent-blue); box-shadow: 0 0 15px var(--accent-blue); }

        .theme-preview .palette-bg { width: 25%; background-color: var(--background-color); }
        .theme-preview .palette-accent1 { width: 25%; background-color: var(--accent-blue); }
        .theme-preview .palette-accent2 { width: 25%; background-color: var(--accent-violet); }
        .theme-preview .palette-button { width: 25%; background-color: var(--button-bg); }
        .theme-preview .preview-text { color: var(--text-primary); }
        .theme-preview .preview-icon { color: var(--text-muted); }

        /* ============================================= */
        /* --- Animações e Outros --- */
        /* ============================================= */
        .hero-background { background: linear-gradient(-45deg, #0D1117, #1E293B, #3730A3, #0D1117); background-size: 400% 400%; animation: gradientBG 15s ease infinite; }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        html[data-theme='gamer-light'] .hero-background { background: linear-gradient(-45deg, #e2e8f0, #cbd5e1, #94a3b8); }
        html[data-theme='matrix-dark'] .hero-background { background: linear-gradient(-45deg, #01100a, #008f11, #39ff14, #01100a); }
        html[data-theme='minty-light'] .hero-background { background: linear-gradient(-45deg, #f0fdfa, #ccfbf1, #5eead4); }
        
        html:not([data-theme='gamer-dark']):not([data-theme='matrix-dark']) .hero-background h1, 
        html:not([data-theme='gamer-dark']):not([data-theme='matrix-dark']) .hero-background p {
            color: #0D1117;
            text-shadow: none;
        }

        #searchInput { width: 0; opacity: 0; transition: all 0.5s ease-in-out; border: 1px solid transparent; }
        #searchInput.active { width: 200px; padding-left: 1rem; padding-right: 1rem; opacity: 1; border: 1px solid var(--border-color); }
        @media (max-width: 640px) { #searchInput.active { width: 120px; } }
        #category-filter-bar::-webkit-scrollbar { display: none; }
        #category-filter-bar { -ms-overflow-style: none; scrollbar-width: none; }
        .category-container.is-overflowing::after {
            content: ''; position: absolute; right: 0; top: 0; bottom: 0; width: 40px;
            background: linear-gradient(to left, var(--card-content-bg), transparent);
            pointer-events: none; transition: opacity 0.3s, background 0.3s;
        }
    </style>
</head>
<body class="transition-colors duration-300">

    <div id="app" class="w-full px-4 sm:px-6 lg:px-8">
        <!-- Cabeçalho -->
        <header class="glass-effect sticky top-4 z-40 flex justify-between items-center py-3 px-6 rounded-2xl mt-4">
            <div class="flex-shrink-0">
                <a href="#" id="homeLink" class="flex items-center space-x-2 cursor-pointer">
                    <i data-lucide="gamepad-2" class="w-8 h-8" style="color: var(--accent-violet)"></i>
                    <span class="text-2xl font-bold text-inherit">GameShare</span>
                </a>
            </div>

            <nav class="hidden md:flex items-center space-x-6 mx-auto">
                <a href="#" class="nav-link text-muted hover:text-inherit font-medium transition-colors flex items-center space-x-2" data-page="mainContent" data-translate-key="nav_games"><i data-lucide="swords" class="w-4 h-4"></i><span>Jogos</span></a>
                <a href="#" class="nav-link text-muted hover:text-inherit font-medium transition-colors flex items-center space-x-2" data-page="page404" data-translate-key="nav_apks"><i data-lucide="smartphone" class="w-4 h-4"></i><span>APKs</span></a>
                <a href="#" class="nav-link text-muted hover:text-inherit font-medium transition-colors flex items-center space-x-2" data-page="announcementsPage" data-translate-key="nav_announcements"><i data-lucide="megaphone" class="w-4 h-4"></i><span>Anúncios</span></a>
            </nav>

            <div class="flex items-center space-x-2 sm:space-x-4">
                <div class="hidden sm:flex items-center">
                    <input id="searchInput" type="text" placeholder="Pesquisar..." data-translate-key="search_placeholder" class="bg-transparent rounded-lg py-2 focus:outline-none focus:ring-2" style="--ring-color: var(--accent-violet);">
                    <button id="searchBtn" class="header-button p-2 rounded-full">
                        <i data-lucide="search" class="w-5 h-5 text-muted"></i>
                    </button>
                </div>
                <div class="relative">
                    <button id="langBtn" class="header-button p-2 rounded-full">
                        <i data-lucide="globe" class="w-5 h-5 text-muted"></i>
                    </button>
                    <div id="langMenu" class="hidden absolute right-0 mt-2 w-48 glass-effect rounded-lg shadow-lg py-1 z-50">
                        <a href="#" class="lang-option block px-4 py-2 text-sm text-inherit" data-lang="pt">Português (BR)</a>
                        <a href="#" class="lang-option block px-4 py-2 text-sm text-inherit" data-lang="en">English (US)</a>
                        <a href="#" class="lang-option block px-4 py-2 text-sm text-inherit" data-lang="es">Español</a>
                        <a href="#" class="lang-option block px-4 py-2 text-sm text-inherit" data-lang="ru">Русский</a>
                    </div>
                </div>
                <button id="themeSelectorBtn" class="header-button p-2 rounded-full">
                     <i data-lucide="palette" class="w-6 h-6 text-muted"></i>
                </button>
                <button id="mobileMenuBtn" class="md:hidden header-button p-2 rounded-full">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </header>
        
        <!-- Menu Mobile -->
        <div id="mobileMenu" class="hidden md:hidden glass-effect rounded-2xl mt-2 p-4">
             <a href="#" class="nav-link block text-muted hover:text-inherit py-2 flex items-center space-x-2" data-page="mainContent" data-translate-key="nav_games_mobile"><i data-lucide="swords" class="w-4 h-4"></i><span>Jogos</span></a>
             <a href="#" class="nav-link block text-muted hover:text-inherit py-2 flex items-center space-x-2" data-page="page404" data-translate-key="nav_apks_mobile"><i data-lucide="smartphone" class="w-4 h-4"></i><span>APKs</span></a>
             <a href="#" class="nav-link block text-muted hover:text-inherit py-2 flex items-center space-x-2" data-page="announcementsPage" data-translate-key="nav_announcements_mobile"><i data-lucide="megaphone" class="w-4 h-4"></i><span>Anúncios</span></a>
        </div>

        <!-- Conteúdo Principal -->
        <div id="mainContent">
            <main class="mt-8">
                <section class="hero-background rounded-2xl shadow-2xl p-8 md:p-16 text-center overflow-hidden">
                    <h1 class="text-4xl md:text-6xl font-extrabold text-white drop-shadow-lg" data-translate-key="hero_title">Seu Universo de Descobertas</h1>
                    <p class="mt-4 text-lg text-slate-300 max-w-2xl mx-auto" data-translate-key="hero_subtitle">Explore recomendações, encontre APKs e mergulhe em novas aventuras selecionadas pela comunidade.</p>
                </section>
                <section class="mt-12 relative">
                    <div id="category-filter-bar" class="flex items-center gap-3 overflow-x-auto whitespace-nowrap py-2 scroll-smooth"></div>
                </section>
                <div class="mt-8">
                    <section>
                        <h2 class="text-3xl font-bold mb-6 section-title" data-translate-key="featured_games_title">Jogos em Destaque</h2>
                        <div id="featured-games-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-5"></div>
                    </section>
                    <section class="mt-16">
                        <h2 class="text-3xl font-bold mb-6 section-title" data-translate-key="all_games_title">Todos os Jogos</h2>
                        <div id="all-games-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4 sm:gap-5"></div>
                        <div id="view-all-container" class="text-center mt-8 hidden">
                            <button id="view-all-btn" class="btn-gradient text-white px-8 py-3 rounded-lg font-bold" data-translate-key="view_all_button">Ver Todos</button>
                        </div>
                        <div id="noResultsMessage" class="hidden text-center col-span-full py-10">
                            <i data-lucide="frown" class="w-16 h-16 mx-auto text-muted"></i>
                            <h3 class="mt-4 text-xl font-semibold" data-translate-key="no_results_title">Nenhum jogo encontrado</h3>
                            <p class="text-muted" data-translate-key="no_results_subtitle">Tente pesquisar com outros termos.</p>
                        </div>
                    </section>
                </div>
            </main>
        </div>
        <div id="page404" class="hidden text-center py-20">
            <i data-lucide="wrench" class="w-24 h-24 mx-auto" style="color: var(--accent-violet)"></i>
            <h1 class="text-6xl font-extrabold mt-8" data-translate-key="coming_soon_title">Em Breve</h1>
            <p class="text-xl text-muted mt-4" data-translate-key="coming_soon_subtitle">Estamos a trabalhar nesta secção!</p>
            <button id="backHomeBtn404" class="mt-8 btn-gradient text-white px-8 py-3 rounded-lg font-bold text-lg" data-translate-key="404_button">Voltar para a Base</button>
        </div>
        <div id="announcementsPage" class="hidden text-center py-20">
            <i data-lucide="megaphone" class="w-24 h-24 mx-auto text-muted"></i>
            <h1 class="text-4xl font-bold mt-8" data-translate-key="announcements_title">Anúncios</h1>
            <div class="glass-effect rounded-2xl p-8 max-w-4xl mx-auto mt-8">
                <p class="text-lg text-muted" data-translate-key="announcement_testing">Este site está em fase de testes. Novas funcionalidades e jogos são adicionados constantemente. Agradecemos a sua visita!</p>
            </div>
            <button id="backHomeBtnAnnouncements" class="mt-8 btn-gradient text-white px-8 py-3 rounded-lg font-bold text-lg" data-translate-key="404_button">Voltar para a Base</button>
        </div>
    </div>
    
    <!-- Modal de Add-ons -->
    <div id="addonsModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="modal-backdrop fixed inset-0"></div>
        <div class="glass-card rounded-2xl w-full max-w-4xl max-h-[90vh] mx-auto z-10 flex flex-col">
            <div class="p-4 border-b border-border-color flex justify-between items-center flex-shrink-0">
                <h2 id="addonsModalTitle" class="text-2xl font-bold">Add-ons</h2>
                <button id="closeAddonsModalBtn" class="header-button p-2 rounded-full">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div id="addonsModalContent" class="p-6 sm:p-8 overflow-y-auto"></div>
        </div>
    </div>

    <!-- Modal de Temas -->
    <div id="themeModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="modal-backdrop fixed inset-0"></div>
        <div class="glass-card rounded-2xl w-full max-w-md mx-auto z-10 flex flex-col">
            <div class="p-4 border-b border-border-color flex justify-between items-center flex-shrink-0">
                <h2 class="text-2xl font-bold" data-translate-key="theme_modal_title">Selecionar Tema</h2>
                <button id="closeThemeModalBtn" class="header-button p-2 rounded-full">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="p-6">
                <div id="themeGrid" class="grid grid-cols-2 gap-4">
                    <!-- Previews dos temas serão injetadas aqui -->
                </div>
            </div>
        </div>
    </div>


    <script>
        // ===================================================================================
        // --- CONFIGURAÇÕES GLOBAIS ---
        // ===================================================================================
        const themes = [
            { id: 'gamer-dark', name: 'Gamer Dark', type: 'dark' },
            { id: 'gamer-light', name: 'Gamer Light', type: 'light' },
            { id: 'matrix-dark', name: 'Matriz', type: 'dark' },
            { id: 'minty-light', name: 'Minty Fresh', type: 'light' },
        ];

        const gamesData = [
            { id: 1, title: "Minecraft", image: "https://placehold.co/400x300/065f46/ffffff?text=Minecraft", categories: ["Sandbox", "Sobrevivência", "Aventura", "Mundo Aberto"], featured: true, hasAddons: true, addons: [{ categoryTitle: "Texturas", files: [{ name: "Faithful 32x" }, { name: "Bare Bones" }] }, { categoryTitle: "Shaders", files: [{ name: "BSL Shaders" }] }] },
            { id: 2, title: "Terraria", image: "https://placehold.co/400x300/581c87/ffffff?text=Terraria", categories: ["Sandbox", "Aventura"], featured: true, hasAddons: false },
        ];

        const translations = {
            en: { theme_modal_title: "Select Theme", nav_games: "Games", nav_apks: "APKs", nav_announcements: "Announcements", nav_games_mobile: "Games", nav_apks_mobile: "APKs", nav_announcements_mobile: "Announcements", search_placeholder: "Search...", hero_title: "Your Universe of Discoveries", hero_subtitle: "Explore recommendations, find APKs, and dive into new adventures selected by the community.", featured_games_title: "Featured Games", all_games_title: "All Games", genre_sandbox: "Sandbox", genre_aventura: "Adventure", genre_sobrevivência: "Survival", "genre_mundo_aberto": "Open World", no_results_title: "No games found", no_results_subtitle: "Try searching with other terms.", coming_soon_title: "Coming Soon", coming_soon_subtitle: "We are working on this section!", "404_button": "Back to Base", download_button: "Download", category_all: "All", addon_modal_title: "Add-ons for", view_all_button: "View All", theme_name_matrix: "Matrix", announcements_title: "Announcements", announcement_testing: "This site is in a testing phase. New features and games are constantly being added. Thank you for your visit!" },
            pt: { theme_modal_title: "Selecionar Tema", nav_games: "Jogos", nav_apks: "APKs", nav_announcements: "Anúncios", nav_games_mobile: "Jogos", nav_apks_mobile: "APKs", nav_announcements_mobile: "Anúncios", search_placeholder: "Pesquisar...", hero_title: "Seu Universo de Descobertas", hero_subtitle: "Explore recomendações, encontre APKs e mergulhe em novas aventuras selecionadas pela comunidade.", featured_games_title: "Jogos em Destaque", all_games_title: "Todos os Jogos", genre_sandbox: "Sandbox", genre_aventura: "Aventura", genre_sobrevivência: "Sobrevivência", "genre_mundo_aberto": "Mundo Aberto", no_results_title: "Nenhum jogo encontrado", no_results_subtitle: "Tente pesquisar com outros termos.", coming_soon_title: "Em Breve", coming_soon_subtitle: "Estamos a trabalhar nesta secção!", "404_button": "Voltar para a Base", download_button: "Baixar", category_all: "Todos", addon_modal_title: "Add-ons para", view_all_button: "Ver Todos", theme_name_matrix: "Matriz", announcements_title: "Anúncios", announcement_testing: "Este site está em fase de testes. Novas funcionalidades e jogos são adicionados constantemente. Agradecemos a sua visita!" },
        };

        // ===================================================================================
        // --- SELETORES DE ELEMENTOS ---
        // ===================================================================================
        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);
        const htmlElement = document.documentElement;

        // ===================================================================================
        // --- FUNÇÕES PRINCIPAIS ---
        // ===================================================================================
        
        const createGameCardHTML = (game) => {
            const currentLang = localStorage.getItem('language') || 'pt';
            const categoriesHTML = game.categories.map(category => {
                const key = `genre_${category.toLowerCase().replace(/ /g, '_')}`;
                const translatedCategory = translations[currentLang]?.[key] || category;
                return `<span class="category-tag text-xs font-semibold px-2.5 py-1 rounded-full cursor-pointer" data-category="${category}">${translatedCategory}</span>`;
            }).join('');

            const addonsButtonHTML = game.hasAddons 
                ? `<button class="open-addons-btn card-button p-2 rounded-lg flex-shrink-0" data-game-id="${game.id}"><i data-lucide="box" class="w-5 h-5 text-muted"></i></button>` 
                : '';

            return `
                <div class="glass-card rounded-2xl game-card flex flex-col overflow-hidden h-full">
                    <div class="relative">
                        <img src="${game.image}" alt="${game.title}" class="w-full aspect-[4/3] object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x300/0D1117/E2E8F0?text=Image+Not+Found';">
                    </div>
                    <div class="p-3 flex flex-col flex-grow card-content">
                        <div class="flex-grow">
                            <h3 class="font-bold text-lg mb-2 text-primary truncate">${game.title}</h3>
                            <div class="category-container relative h-7 flex items-center overflow-hidden mb-2">
                                <div class="category-list absolute flex items-center gap-2 whitespace-nowrap">
                                    ${categoriesHTML}
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <a href="#" class="w-full flex-grow card-button text-center py-2 px-3 rounded-lg font-semibold flex items-center justify-center space-x-2 text-sm">
                                <i data-lucide="download" class="w-4 h-4"></i>
                                <span data-translate-key="download_button">${translations[currentLang]?.download_button || 'Baixar'}</span>
                            </a>
                            ${addonsButtonHTML}
                        </div>
                    </div>
                </div>
            `;
        };

        const renderGames = () => {
            const featuredGrid = $('#featured-games-grid');
            const allGamesGrid = $('#all-games-grid');
            const viewAllContainer = $('#view-all-container');

            if (featuredGrid) featuredGrid.innerHTML = gamesData.filter(g => g.featured).map(createGameCardHTML).join('');
            
            if (allGamesGrid) {
                const allGamesHTML = gamesData.map((game, index) => {
                    const isVisibleInitially = index < 14;
                    return `<div class="game-wrapper ${isVisibleInitially ? '' : 'hidden'}" data-title="${game.title}" data-categories="${game.categories.join(',')}">${createGameCardHTML(game)}</div>`;
                }).join('');
                allGamesGrid.innerHTML = allGamesHTML;
            }
            
            if(viewAllContainer) viewAllContainer.classList.toggle('hidden', gamesData.length <= 14);

            lucide.createIcons();
            initCategoryAnimation();
        };
        
        const setLanguage = (lang) => {
            localStorage.setItem('language', lang);
            htmlElement.lang = lang;
            const langTranslations = translations[lang] || translations.pt;
            $$('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                const translation = langTranslations[key];
                if(translation === undefined) return;

                const span = el.querySelector('span');
                if (el.placeholder) {
                    el.placeholder = translation;
                } else if (span && !el.classList.contains('nav-link')) {
                     // Avoid replacing entire nav-link content if it has an icon
                    span.textContent = translation;
                } else {
                    el.textContent = translation;
                }
            });
            generateCategoryFilters();
            renderGames();
            generateThemePreviews(); // Re-generate previews for language change
        };

        const setTheme = (themeId) => {
            htmlElement.dataset.theme = themeId;
            localStorage.setItem('selectedTheme', themeId);
            $$('#themeGrid .theme-preview').forEach(preview => {
                preview.classList.toggle('active', preview.dataset.themeId === themeId);
            });
        };

        const generateThemePreviews = () => {
            const themeGrid = $('#themeGrid');
            if(!themeGrid) return;
            const currentLang = localStorage.getItem('language') || 'pt';
            
            themeGrid.innerHTML = themes.map(theme => {
                let themeName = theme.name;
                if (theme.id === 'matrix-dark') {
                    themeName = translations[currentLang]?.theme_name_matrix || theme.name;
                }

                return `
                <div class="theme-preview rounded-lg p-3" data-theme-id="${theme.id}">
                    <div class="flex items-center justify-between mb-2">
                         <h3 class="font-bold text-sm preview-text">${themeName}</h3>
                         <i data-lucide="${theme.type === 'dark' ? 'moon' : 'sun'}" class="w-4 h-4 preview-icon"></i>
                    </div>
                    <div class="flex h-8 rounded overflow-hidden">
                        <div class="palette-bg"></div>
                        <div class="palette-accent1"></div>
                        <div class="palette-accent2"></div>
                        <div class="palette-button"></div>
                    </div>
                </div>
            `}).join('');
            
            $$('#themeGrid .theme-preview').forEach(preview => {
                const themeId = preview.dataset.themeId;
                preview.setAttribute('data-theme', themeId);
                preview.addEventListener('click', () => setTheme(themeId));
            });
            lucide.createIcons();
        };
        
        // --- Funções de UI e Animações ---
        const showPage = (pageId) => {
            $('#mainContent')?.classList.add('hidden');
            $('#page404')?.classList.add('hidden');
            $('#announcementsPage')?.classList.add('hidden');
            
            const pageToShow = $(`#${pageId}`);
            if(pageToShow) {
                pageToShow.classList.remove('hidden');
            } else {
                $('#page404')?.classList.remove('hidden');
            }
        };

        const initCategoryAnimation = () => {
            $$('.category-container').forEach(container => {
                const list = container.querySelector('.category-list');
                if (!list || list.children.length < 2) return;

                if (container.intervalId) clearInterval(container.intervalId);
                if (container.resizeObserver) container.resizeObserver.disconnect();

                const checkAndAnimate = () => {
                    const isOverflowing = list.scrollWidth > container.clientWidth;
                    container.classList.toggle('is-overflowing', isOverflowing);

                    if (isOverflowing && !container.intervalId) {
                         container.intervalId = setInterval(() => {
                            const firstTag = list.children[0];
                            if (!firstTag) return;
                            const tagWidth = firstTag.offsetWidth;
                            const gap = parseInt(window.getComputedStyle(list).gap) || 8;

                            list.style.transition = 'transform 0.5s ease-in-out';
                            list.style.transform = `translateX(-${tagWidth + gap}px)`;

                            setTimeout(() => {
                                list.style.transition = 'none';
                                list.appendChild(firstTag);
                                list.style.transform = 'translateX(0)';
                            }, 500);
                        }, 2500);
                    } else if (!isOverflowing && container.intervalId) {
                        clearInterval(container.intervalId);
                        container.intervalId = null;
                        list.style.transition = 'none';
                        list.style.transform = 'translateX(0)';
                    }
                };
                
                setTimeout(checkAndAnimate, 50);
                container.resizeObserver = new ResizeObserver(checkAndAnimate);
                container.resizeObserver.observe(container);
            });
        };
        
        const updateFilters = () => {
            const searchInput = $('#searchInput');
            if(!searchInput) return;

            const searchTerm = searchInput.value.toLowerCase();
            const activeCategory = $('.category-filter.active')?.dataset.category;
            
            let totalVisible = 0;
            $$('.game-wrapper').forEach(wrapper => {
                const title = wrapper.dataset.title.toLowerCase();
                const categories = wrapper.dataset.categories.split(',');
                const searchMatch = title.includes(searchTerm);
                const categoryMatch = !activeCategory || activeCategory === 'Todos' || categories.includes(activeCategory);
                const isVisible = searchMatch && categoryMatch;
                wrapper.style.display = isVisible ? 'block' : 'none';
                if(isVisible) totalVisible++;
            });

            const isFiltering = searchTerm.length > 0 || (activeCategory && activeCategory !== 'Todos');
            $$('.section-title').forEach(title => title.style.display = isFiltering ? 'none' : 'block');
            
            const noResultsMessage = $('#noResultsMessage');
            if(noResultsMessage) noResultsMessage.style.display = (totalVisible === 0 && isFiltering) ? 'block' : 'none';
            
            const viewAllContainer = $('#view-all-container');
            if(viewAllContainer) viewAllContainer.style.display = isFiltering ? 'none' : (gamesData.length > 14 ? 'block' : 'none');
        };

        const generateCategoryFilters = () => {
            const categoryFilterBar = $('#category-filter-bar');
            if(!categoryFilterBar) return;

            const categories = new Set(gamesData.flatMap(game => game.categories));
            const currentLang = localStorage.getItem('language') || 'pt';
            const allText = translations[currentLang]?.category_all || "Todos";
            
            let filterButtonsHTML = `<button class="category-filter active px-4 py-2 rounded-lg text-sm font-semibold" data-category="Todos">${allText}</button>`;
            categories.forEach(category => {
                const key = `genre_${category.toLowerCase().replace(/ /g, '_')}`;
                const translatedCategory = translations[currentLang]?.[key] || category;
                filterButtonsHTML += `<button class="category-filter px-4 py-2 rounded-lg text-sm font-semibold" data-category="${category}">${translatedCategory}</button>`;
            });
            categoryFilterBar.innerHTML = filterButtonsHTML;
            
            $$('.category-filter').forEach(button => {
                button.addEventListener('click', (e) => {
                    const category = e.currentTarget.dataset.category;
                    $$('.category-filter').forEach(btn => btn.classList.toggle('active', btn.dataset.category === category));
                    updateFilters();
                });
            });
        };

        const openAddonsModal = (gameId) => {
            const addonsModal = $('#addonsModal');
            if(!addonsModal) return;
            const game = gamesData.find(g => g.id === gameId);
            if (!game || !game.hasAddons) return;

            const currentLang = localStorage.getItem('language') || 'pt';
            $('#addonsModalTitle').textContent = `${translations[currentLang]?.addon_modal_title || 'Add-ons para'} ${game.title}`;
            
            let addonsHTML = '';
            game.addons.forEach(category => {
                addonsHTML += `<h3 class="text-xl font-bold mb-3 mt-4 first:mt-0">${category.categoryTitle}</h3>`;
                addonsHTML += '<div class="space-y-3">';
                category.files.forEach(file => {
                    addonsHTML += `
                        <div class="addon-item rounded-lg p-3 flex justify-between items-center">
                            <span>${file.name}</span>
                            <a href="#" class="addon-download-btn p-2 rounded-lg">
                                <i data-lucide="download" class="w-5 h-5 text-muted"></i>
                            </a>
                        </div>
                    `;
                });
                addonsHTML += '</div>';
            });
            
            $('#addonsModalContent').innerHTML = addonsHTML;
            lucide.createIcons();
            addonsModal.classList.remove('hidden');
        };

        // ===================================================================================
        // --- EVENT LISTENERS E INICIALIZAÇÃO ---
        // ===================================================================================
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('selectedTheme') || 'gamer-dark';
            const savedLang = localStorage.getItem('language') || 'pt';
            
            setLanguage(savedLang);
            generateThemePreviews();
            setTheme(savedTheme);

            // --- Listeners Gerais ---
            $('#homeLink')?.addEventListener('click', (e) => { e.preventDefault(); showPage('mainContent'); });
            $('#backHomeBtn404')?.addEventListener('click', (e) => { e.preventDefault(); showPage('mainContent'); });
            $('#backHomeBtnAnnouncements')?.addEventListener('click', (e) => { e.preventDefault(); showPage('mainContent'); });
            $('#searchBtn')?.addEventListener('click', () => { $('#searchInput')?.classList.toggle('active'); $('#searchInput')?.focus(); });
            $('#searchInput')?.addEventListener('input', updateFilters);
            $('#view-all-btn')?.addEventListener('click', () => {
                $$('#all-games-grid .game-wrapper').forEach(w => w.classList.remove('hidden'));
                $('#view-all-container')?.classList.add('hidden');
            });

            // --- Listeners de Navegação e Menus ---
            $$('.nav-link').forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); showPage(e.currentTarget.dataset.page); }));
            $('#mobileMenuBtn')?.addEventListener('click', () => $('#mobileMenu')?.classList.toggle('hidden'));
            $('#langBtn')?.addEventListener('click', () => $('#langMenu')?.classList.toggle('hidden'));
            $$('.lang-option').forEach(option => option.addEventListener('click', (e) => {
                e.preventDefault();
                setLanguage(e.currentTarget.dataset.lang);
                $('#langMenu')?.classList.add('hidden');
            }));

            // --- Listeners de Modais ---
            $('#themeSelectorBtn')?.addEventListener('click', () => $('#themeModal')?.classList.remove('hidden'));
            $('#closeThemeModalBtn')?.addEventListener('click', () => $('#themeModal')?.classList.add('hidden'));
            $('#themeModal .modal-backdrop')?.addEventListener('click', () => $('#themeModal')?.classList.add('hidden'));
            
            $('#closeAddonsModalBtn')?.addEventListener('click', () => $('#addonsModal')?.classList.add('hidden'));
            $('#addonsModal .modal-backdrop')?.addEventListener('click', () => $('#addonsModal')?.classList.add('hidden'));
            
            document.body.addEventListener('click', (e) => {
                const addonsBtn = e.target.closest('.open-addons-btn');
                if (addonsBtn) openAddonsModal(parseInt(addonsBtn.dataset.gameId, 10));
            });
        });
    </script>
</body>
</html>
